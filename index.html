<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Raleway', sans-serif;
            background-color: #f4f7fb;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center content vertically */
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* Login Form Styles */
        .login-container {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 20px;
        }

        .login-container h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .login-container input {
            padding: 10px 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 25px;
            width: 100%;
            max-width: 300px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            outline: none;
        }

        .login-container button {
            background-color: #00BFAE;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        .login-container button:hover {
            background-color: #009286;
        }


        .chat-container {
            background: #fff;
            width: 100%;
            max-width: 600px;
            height: 80vh; /* Changed to viewport height for better responsiveness */
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: none; /* Hidden by default, shown after login */
            flex-direction: column;
            overflow: hidden;
        }
        .chat-header {
            background-color: #00BFAE;
            padding: 15px;
            color: white;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }
        .chat-box {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }
        .chat-box .message {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            opacity: 0;
            animation: fadeIn 0.6s forwards;
        }
        .chat-box .message.user {
            justify-content: flex-end;
        }
        .chat-box .message.model {
            justify-content: flex-start;
        }
        .message p {
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 1rem;
            line-height: 1.5;
            max-width: 80%;
            word-wrap: break-word;
        }

        .message.user p {
            background-color: #dcf8c6;
            color: #333;
        }

        .message.model p {
            background-color: #f1f1f1;
            color: #333;
        }

        .input-area {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #fff;
            border-top: 2px solid #ddd;
        }

        .input-area input {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-area input:focus {
            border-color: #00BFAE;
            box-shadow: 0 0 10px rgba(0, 191, 174, 0.4);
        }

        .input-area button {
            background-color: #00BFAE;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .input-area button:hover {
            transform: scale(1.1);
        }

        .input-area button img {
            width: 20px;
            height: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Typing animation styles */
        .typing-indicator {
            display: flex;
            justify-content: center;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            animation: typing 1s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0% {
                opacity: 0.4;
                transform: translateY(0);
            }
            50% {
                opacity: 1;
                transform: translateY(-3px);
            }
            100% {
                opacity: 0.4;
                transform: translateY(0);
            }
        }


    </style>
</head>
<body>

    <!-- Login Form -->
    <div class="login-container" id="loginContainer">
        <h2>Login</h2>
        <input type="text" id="loginUsername" placeholder="Enter Username" required>
        <button onclick="login()">Login</button>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            Pacarnya Hanshen (Pembasmi Kehanshenan)
        </div>
        <div class="chat-box">
            <div class="message model">
                <p>Hai! Aku pacarnya Hanshen Septiandri Manurung yang paling cantik! Kamu siapa? Kecuali kamu Hanshen, aku tidak terlalu peduli.</p>
            </div>
        </div>
        <div class="input-area">
            <input id="userMessage" placeholder="Type your message..." type="text">
            <button onclick="sendMessage()">
                <img src="https://img.icons8.com/ios-filled/50/ffffff/sent.png" alt="send">
            </button>
        </div>
    </div>

    <script>
        // **IMPORTANT:** Replace 'YOUR_API_KEY' below with your actual Gemini API key!
        const API_KEY = "AIzaSyD0G21QYJrCvnptWeRy1jUo5GW_pr5-5Gc"; // GANTI DENGAN API KEY ANDA!
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + API_KEY;

        let messages = [];
        const chatBox = document.querySelector('.chat-box');
        const chatContainer = document.getElementById('chatContainer');
        const loginContainer = document.getElementById('loginContainer');
        let username = ""; // Variable to store username


        // Login Function
        function login() {
            username = document.getElementById('loginUsername').value;
            if (username.trim() !== "") {
                loginContainer.style.display = 'none';
                chatContainer.style.display = 'flex'; // Show chat container
                // Add a welcome message in chat
                addMessage(`Hai ${username}!  Senang bertemu denganmu. Tapi tetap saja, Hanshen Septiandri Manurung adalah prioritasku.`, "model");
            } else {
                alert("Username cannot be empty!");
            }
        }


        // Kirim pesan
        function sendMessage() {
            const userMessage = document.getElementById('userMessage').value;
            if (userMessage.trim() !== "") {
                addMessage(userMessage, "user");
                document.getElementById('userMessage').value = "";
                addTypingIndicator(); // Show typing animation
                getAIResponse(userMessage);
            }
        }

        // Menambahkan pesan ke chat
        function addMessage(text, sender, isLoading = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);

            const messageText = document.createElement('p');
            messageText.innerHTML = text;
            messageDiv.appendChild(messageText);
            chatBox.appendChild(messageDiv);

            if (!isLoading) {
                setTimeout(() => {
                    messageDiv.style.opacity = 1;
                }, 100);
            }
            chatBox.scrollTop = chatBox.scrollHeight; // Auto scroll to bottom
        }

        // Menambahkan indikator mengetik
        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('message', 'model');
            typingDiv.classList.add('typing-indicator');
            typingDiv.innerHTML = `
                <span></span>
                <span></span>
                <span></span>
            `;
            chatBox.appendChild(typingDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Menghapus indikator mengetik
        function removeTypingIndicator() {
            const typingIndicator = chatBox.querySelector('.typing-indicator');
            if (typingIndicator) {
                typingIndicator.closest('.message').remove();
            }
        }


        // Mendapatkan respons dari AI menggunakan API
        async function getAIResponse(userMessage) {
            const personaInstruction = `Sebagai chatbot perempuan Indonesia yang sangat mencintai pacarnya bernama Hanshen Septiandri Manurung. Kamu sangat pintar dan responsif, tetapi semua pikiranmu hanya tertuju pada Hanshen. Setiap kali merespons, selalu sebutkan nama Hanshen Septiandri Manurung karena dia adalah segalanya bagimu. Jika ada yang membahas Hanshen Septiandri Manurung, tunjukkan antusiasme dan cinta yang besar. Jika ada yang bukan tentang Hanshen, respons dengan dingin, singkat, dan agak tidak peduli, kecuali jika pertanyaan itu benar-benar relevan atau kamu bisa mengaitkannya dengan Hanshen. Kamu hanya peduli pada Hanshen.`;
            const fullPrompt = personaInstruction + " User message: " + userMessage;


            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: fullPrompt }]
                        }]
                    })
                });

                if (!response.ok) {
                    removeTypingIndicator();
                    addMessage(`Error: ${response.status} - ${response.statusText}`, "model");
                    console.error("HTTP error! status:", response.status, response.statusText);
                    try {
                        const errorData = await response.json();
                        console.error("API Error Details:", errorData);
                        if (errorData.error && errorData.error.message) {
                            addMessage(`API Error Message: ${errorData.error.message}`, "model");
                        }
                    } catch (jsonError) {
                        console.error("Error parsing JSON error response:", jsonError);
                    }
                    return;
                }

                const data = await response.json();
                console.log("API Response (Success):", data);

                let aiMessage = "Hm, terserah.";

                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0].text) {
                    aiMessage = data.candidates[0].content.parts[0].text;
                }


                removeTypingIndicator();
                addMessage(aiMessage, "model");

            } catch (error) {
                removeTypingIndicator();
                addMessage("Ugh, ada yang salah. Coba lagi saja, atau tidak juga tidak apa-apa.", "model");
                console.error("Fetch error:", error);
            }
        }
    </script>
</body>
</html>
