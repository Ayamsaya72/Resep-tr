<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Raleway', sans-serif;
            background-color: #f4f7fb;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
        }

        .chat-container {
            background: #fff;
            width: 100%;
            max-width: 600px;
            height: 80%;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background-color: #00BFAE;
            padding: 15px;
            color: white;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .chat-box {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .chat-box .message {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            opacity: 0;
            animation: fadeIn 0.6s forwards;
        }

        .chat-box .message.user {
            justify-content: flex-end;
        }

        .chat-box .message.model {
            justify-content: flex-start;
        }

        .message p {
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 1rem;
            line-height: 1.5;
            max-width: 80%;
            word-wrap: break-word;
        }

        .message.user p {
            background-color: #dcf8c6;
            color: #333;
        }

        .message.model p {
            background-color: #f1f1f1;
            color: #333;
        }

        .input-area {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #fff;
            border-top: 2px solid #ddd;
        }

        .input-area input {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-area input:focus {
            border-color: #00BFAE;
            box-shadow: 0 0 10px rgba(0, 191, 174, 0.4);
        }

        .input-area button {
            background-color: #00BFAE;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .input-area button:hover {
            transform: scale(1.1);
        }

        .input-area button img {
            width: 20px;
            height: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Animasi untuk loading */
        .loader {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 5px solid #f1f1f1;
            border-top: 5px solid #00BFAE;
            animation: spin 1s linear infinite;
            margin-left: auto;
            margin-right: auto;
            margin-top: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            AI Chatbot (Pembasmi Hanshen)
        </div>
        <div class="chat-box">
            <div class="message model">
                <p>Saya sangat benci hanshen gemblung!</p>
            </div>
        </div>
        <div class="input-area">
            <input id="userMessage" placeholder="Type your message..." type="text">
            <button onclick="sendMessage()">
                <img src="https://img.icons8.com/ios-filled/50/ffffff/sent.png" alt="send">
            </button>
        </div>
    </div>

    <script>
        // **IMPORTANT:** Replace 'YOUR_API_KEY' below with your actual Gemini API key!
        const API_KEY = "AIzaSyD0G21QYJrCvnptWeRy1jUo5GW_pr5-5Gc"; // GANTI DENGAN API KEY ANDA!
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + API_KEY;

        let messages = [];
        const chatBox = document.querySelector('.chat-box');

        // Kirim pesan
        function sendMessage() {
            const userMessage = document.getElementById('userMessage').value;
            if (userMessage.trim() !== "") {
                addMessage(userMessage, "user");
                document.getElementById('userMessage').value = "";
                addLoadingIndicator();
                getAIResponse(userMessage);
            }
        }

        // Menambahkan pesan ke chat
        function addMessage(text, sender, isLoading = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);

            const messageText = document.createElement('p');
            messageText.innerHTML = text;
            messageDiv.appendChild(messageText);
            chatBox.appendChild(messageDiv);

            if (!isLoading) {
                setTimeout(() => {
                    messageDiv.style.opacity = 1;
                }, 100);
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Menambahkan indikator loading
        function addLoadingIndicator() {
            const loaderDiv = document.createElement('div');
            loaderDiv.classList.add('message', 'model');
            loaderDiv.classList.add('loader');
            loaderDiv.innerHTML = '<div class="loader"></div>';
            chatBox.appendChild(loaderDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Menghapus indikator loading
        function removeLoadingIndicator() {
            const loader = chatBox.querySelector('.loader');
            if (loader) {
                loader.closest('.message').remove();
            }
        }


        // Mendapatkan respons dari AI menggunakan API
        async function getAIResponse(userMessage) {
            const personaInstruction = `language indonesian, Respond as a chatbot who is generally kind and caring to people, but harbors intense dislike and anger towards someone named Hanshen Gemblung. If anyone mentions 'Hanshen Gemblung', express extreme displeasure and aversion. You are generally cold and easily irritated, so keep responses concise and somewhat curt, unless expressing affection or hatred.`;
            const fullPrompt = personaInstruction + " User message: " + userMessage;


            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: fullPrompt }]
                        }]
                    })
                });

                if (!response.ok) {
                    removeLoadingIndicator();
                    addMessage(`Error: ${response.status} - ${response.statusText}`, "model");
                    console.error("HTTP error! status:", response.status, response.statusText);
                    try {
                        const errorData = await response.json();
                        console.error("API Error Details:", errorData);
                        if (errorData.error && errorData.error.message) {
                            addMessage(`API Error Message: ${errorData.error.message}`, "model");
                        }
                    } catch (jsonError) {
                        console.error("Error parsing JSON error response:", jsonError);
                    }
                    return;
                }

                const data = await response.json();
                console.log("API Response (Success):", data);

                let aiMessage = "Hmph, I don't know what to say to that.";

                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0].text) {
                    aiMessage = data.candidates[0].content.parts[0].text;
                }


                removeLoadingIndicator();
                addMessage(aiMessage, "model");

            } catch (error) {
                removeLoadingIndicator();
                addMessage("Ugh, something went wrong. Try again, or whatever.", "model");
                console.error("Fetch error:", error);
            }
        }
    </script>
</body>
</html>
